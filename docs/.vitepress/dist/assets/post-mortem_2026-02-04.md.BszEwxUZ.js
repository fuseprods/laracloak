import{_ as a,o as t,c as o,ae as i}from"./chunks/framework.BFWHsNam.js";const p=JSON.parse('{"title":"Post-Mortem: Dashboard Freeze in Production (2026-02-04)","description":"","frontmatter":{},"headers":[],"relativePath":"post-mortem_2026-02-04.md","filePath":"post-mortem_2026-02-04.md"}'),r={name:"post-mortem_2026-02-04.md"};function n(s,e,l,d,c,h){return t(),o("div",null,[...e[0]||(e[0]=[i('<h1 id="post-mortem-dashboard-freeze-in-production-2026-02-04" tabindex="-1">Post-Mortem: Dashboard Freeze in Production (2026-02-04) <a class="header-anchor" href="#post-mortem-dashboard-freeze-in-production-2026-02-04" aria-label="Permalink to &quot;Post-Mortem: Dashboard Freeze in Production (2026-02-04)&quot;">​</a></h1><h2 id="summary" tabindex="-1">Summary <a class="header-anchor" href="#summary" aria-label="Permalink to &quot;Summary&quot;">​</a></h2><p>On February 4th, 2026, dashboards in the production environment were reported as &quot;frozen,&quot; showing persistent loading spinners instead of rendering widget data. Data was arriving in the browser (visible in DevTools Network tab), but the UI failed to update.</p><h2 id="symptoms" tabindex="-1">Symptoms <a class="header-anchor" href="#symptoms" aria-label="Permalink to &quot;Symptoms&quot;">​</a></h2><ul><li>Widgets stuck in &quot;Waiting for data...&quot; state.</li><li>Browser DevTools showed 200 OK responses with valid JSON payloads.</li><li>Issue was non-reproducible in the local development environment.</li></ul><h2 id="root-causes" tabindex="-1">Root Causes <a class="header-anchor" href="#root-causes" aria-label="Permalink to &quot;Root Causes&quot;">​</a></h2><h3 id="_1-strict-content-type-validation" tabindex="-1">1. Strict Content-Type Validation <a class="header-anchor" href="#_1-strict-content-type-validation" aria-label="Permalink to &quot;1. Strict Content-Type Validation&quot;">​</a></h3><p>In <code>front.js</code>, the code was checking for an exact match of <code>application/json</code>.</p><ul><li><strong>Local environment</strong>: Headers were clean <code>application/json</code>.</li><li><strong>Production environment</strong>: The server/proxy appended charset information (e.g., <code>application/json; charset=UTF-8</code>), causing the check to fail and the payload to be ignored.</li></ul><h3 id="_2-upstream-data-structure-variances" tabindex="-1">2. Upstream Data Structure Variances <a class="header-anchor" href="#_2-upstream-data-structure-variances" aria-label="Permalink to &quot;2. Upstream Data Structure Variances&quot;">​</a></h3><p>The upstream service (n8n) often returns data wrapped in an array <code>[ { &quot;key&quot;: &quot;value&quot; } ]</code>.</p><ul><li><strong>Failure</strong>: The initial <code>getNestedValue</code> implementation expected the object at the root. When receiving an array, it failed to find the keys, leaving widgets without data.</li></ul><h3 id="_3-aggressive-browser-caching" tabindex="-1">3. Aggressive Browser Caching <a class="header-anchor" href="#_3-aggressive-browser-caching" aria-label="Permalink to &quot;3. Aggressive Browser Caching&quot;">​</a></h3><p>After initial fixes were deployed, the production environment continued to fail because browsers were serving a cached version of <code>front.js</code> from before the fixes.</p><h3 id="_4-lack-of-error-isolation" tabindex="-1">4. Lack of Error Isolation <a class="header-anchor" href="#_4-lack-of-error-isolation" aria-label="Permalink to &quot;4. Lack of Error Isolation&quot;">​</a></h3><p>A failure in one widget&#39;s rendering logic (or a data mismatch) could potentially stall the entire rendering loop, providing no feedback to the user or developer.</p><h2 id="resolution" tabindex="-1">Resolution <a class="header-anchor" href="#resolution" aria-label="Permalink to &quot;Resolution&quot;">​</a></h2><h3 id="frontend-resilience-front-js" tabindex="-1">Frontend Resilience (<code>front.js</code>) <a class="header-anchor" href="#frontend-resilience-front-js" aria-label="Permalink to &quot;Frontend Resilience (`front.js`)&quot;">​</a></h3><ul><li><strong>Robust Headers</strong>: Changed <code>contentType.includes(&#39;application/json&#39;)</code> to be case-insensitive and allow for extra parameters.</li><li><strong>Intelligent Pathing</strong>: Added logic to automatically unwrap single-element arrays (n8n style) when resolving data keys.</li><li><strong>Error Isolation</strong>: Wrapped each widget&#39;s render call in a <code>try/catch</code> block. If one widget fails, others continue to load.</li><li><strong>Debug Logging</strong>: Added console groups and startup logs to provide immediate visibility into the engine&#39;s state and received data.</li></ul><h3 id="backend-stabilization" tabindex="-1">Backend Stabilization <a class="header-anchor" href="#backend-stabilization" aria-label="Permalink to &quot;Backend Stabilization&quot;">​</a></h3><ul><li><strong>Explicit Headers</strong>: Forced the <code>Content-Type: application/json</code> header in <code>FrontController</code> when returning sanitized payloads.</li></ul><h3 id="cache-busting" tabindex="-1">Cache Busting <a class="header-anchor" href="#cache-busting" aria-label="Permalink to &quot;Cache Busting&quot;">​</a></h3><ul><li><strong>Deployment Strategy</strong>: Added a timestamp-based versioning to the script tag in <code>page.blade.php</code> to ensure the latest code is always loaded:<div class="language-html vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">html</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">script</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> src</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;{{ asset(&#39;js/front.js&#39;) }}?v={{ time() }}&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">script</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span></code></pre></div></li></ul><h2 id="lessons-learned" tabindex="-1">Lessons Learned <a class="header-anchor" href="#lessons-learned" aria-label="Permalink to &quot;Lessons Learned&quot;">​</a></h2><ul><li>Always use <code>.includes()</code> and <code>.toLowerCase()</code> when checking HTTP headers.</li><li>Design data parsers to be &quot;forgiving&quot; regarding root arrays vs. objects, especially when proxying third-party services like n8n.</li><li>Implement cache-busting for critical frontend assets from day one.</li><li>Provide fallback UI states (like &quot;--&quot;) instead of infinite spinners when data resolution fails.</li></ul>',25)])])}const g=a(r,[["render",n]]);export{p as __pageData,g as default};
